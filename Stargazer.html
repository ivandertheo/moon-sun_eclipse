<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Gerhana Matahari & Bulan</title>
  <style>
    body, html { margin: 0; height: 100%; background: #000; overflow: hidden; }
    canvas { display: block; }

    /* UI Panel */
    #ui {
      position: fixed;
      top: 20px;
      left: 20px;
      padding: 15px;
      background: rgba(0,0,0,0.55);
      color: #fff;
      font-family: Arial, sans-serif;
      border-radius: 10px;
      width: 240px;
      z-index: 999;
      backdrop-filter: blur(4px);
    }

    #ui label {
      display: block;
      margin-top: 12px;
      font-size: 14px;
      font-weight: 600;
    }

    #ui input[type=range] {
      width: 100%;
    }

    #ui button {
      margin-top: 14px;
      padding: 8px 12px;
      width: 100%;
      font-weight: bold;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background: #4287f5;
      color: white;
    }

    .hint {
      margin-top: 10px;
      font-size: 11px;
      opacity: 0.8;
    }
  </style>

  <!-- IMPORT MAP -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.161.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.161.0/examples/jsm/"
    }
  }
  </script>
</head>

<body>

<!-- UI SLIDERS -->
<div id="ui">
  <div style="font-weight:600; font-size:16px;">Gerhana — Three.js Demo</div>

  <label>Orbital angle (°): <span id="angleVal">0</span></label>
  <input id="angle" type="range" min="-30" max="30" step="0.1" value="0" />

  <label>Moon distance (relative): <span id="distVal">2.0</span></label>
  <input id="moonDist" type="range" min="1.4" max="3.0" step="0.01" value="2.0" />


  <label>Animation speed: <span id="speedVal">1</span></label>
  <input id="speed" type="range" min="0" max="2" step="0.01" value="1" />

  <button id="reset">Reset posisi</button>

  <div class="hint">Gunakan mouse: drag untuk rotate, scroll untuk zoom.</div>
</div>

<script type="module">
  import * as THREE from "three";
  import { OrbitControls } from "three/addons/controls/OrbitControls.js";

  // Scene, Camera, Renderer
  const scene = new THREE.Scene();

  const camera = new THREE.PerspectiveCamera(
    65,
    window.innerWidth / window.innerHeight,
    0.1,
    1000
  );
  camera.position.set(8, 5, 12);

  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled = true;
  document.body.appendChild(renderer.domElement);

  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  // Objects
  //texture
  const texLoader = new THREE.TextureLoader();

  const sunTexture = texLoader.load('models/sunTex.png');
  const sun = new THREE.Mesh(
    new THREE.SphereGeometry(2, 32, 32),
    new THREE.MeshStandardMaterial({
    map: sunTexture, 
    emissive: 0xF46301, 
    emissiveIntensity: 1
    })
  );
  scene.add(sun);

  const sunLight = new THREE.PointLight(0xffffff, 3, 200);
  sunLight.position.set(0, 0, 0); 
  scene.add(sunLight);

  const earthTexture = texLoader.load('models/earthTex.png');
  const earth = new THREE.Mesh(
    new THREE.SphereGeometry(1, 32, 32),
    new THREE.MeshStandardMaterial({
    map: earthTexture
    })
  );
  scene.add(earth);

  const moonTexture = texLoader.load('models/moonTex.png');
  const moon = new THREE.Mesh(
    new THREE.SphereGeometry(0.4, 32, 32),
    new THREE.MeshStandardMaterial({
    map: moonTexture
    })
  );
  scene.add(moon);

  scene.add(new THREE.AmbientLight(0xffffff, 0.3));

  //star
  function createStars() {
  const starGeometry = new THREE.BufferGeometry();
  const starCount = 2000;
  const positions = [];

  for (let i = 0; i < starCount; i++) {
    const x = (Math.random() - 0.5) * 400;
    const y = (Math.random() - 0.5) * 400;
    const z = (Math.random() - 0.5) * 400;
    positions.push(x, y, z);
  }

  starGeometry.setAttribute(
    "position",
    new THREE.Float32BufferAttribute(positions, 3)
  );

  const starMaterial = new THREE.PointsMaterial({
    color: 0xffffff,
    size: 0.8,
  });

  const stars = new THREE.Points(starGeometry, starMaterial);
  scene.add(stars);
}

createStars();


  // Animation speed variable
  let speedEarth = 0.0004;
  let speedMoon = 0.0012;
  let baseEarth = 0.0004;
  let baseMoon = 0.0012;

  // Slider references
  const angleSlider = document.getElementById("angle");
  const distSlider = document.getElementById("moonDist");
  const speedSlider = document.getElementById("speed");

  const angleVal = document.getElementById("angleVal");
  const distVal = document.getElementById("distVal");
  const speedVal = document.getElementById("speedVal");

  let angleDeg = 0;
  let moonDist = 2.0;
  let speedFactor = 1;

  // Update handlers
  angleSlider.oninput = () => {
    angleDeg = parseFloat(angleSlider.value);
    angleVal.textContent = angleDeg.toFixed(1);
  };

  distSlider.oninput = () => {
    moonDist = parseFloat(distSlider.value);
    distVal.textContent = moonDist.toFixed(2);
  };

  speedSlider.oninput = () => {
    speedFactor = parseFloat(speedSlider.value);
    speedVal.textContent = speedFactor.toFixed(2);
    speedEarth = baseEarth * speedFactor;
    speedMoon = baseMoon * speedFactor * 3; // moon orbit faster
  };

  // Reset button
  document.getElementById("reset").onclick = () => {
    angleSlider.value = 0;
    distSlider.value = 2.0;
    speedSlider.value = 1;

    angleDeg = 0;
    moonDist = 2.0;
    speedFactor = 1;

    angleVal.textContent = "0";
    distVal.textContent = "2.0";
    speedVal.textContent = "1";

    speedEarth = baseEarth;
    speedMoon = baseMoon * 3;
  };

  // Animation loop
  function animate() {
    requestAnimationFrame(animate);

    const t = Date.now() * speedEarth;
    const t2 = Date.now() * speedMoon;

    const angleRad = angleDeg * (Math.PI / 180);

    // Earth orbit
    earth.position.x = Math.cos(t) * 6;
    earth.position.z = Math.sin(t) * 6;

    // Apply orbital tilt
    earth.position.y = Math.sin(angleRad) * 1.2;

    // Moon orbit
    moon.position.x = earth.position.x + Math.cos(t2) * moonDist;
    moon.position.z = earth.position.z + Math.sin(t2) * moonDist;

    moon.position.y = earth.position.y + Math.sin(angleRad) * 0.5;

    earth.rotation.y += 0.01;
    moon.rotation.y += 0.015;

    controls.update();
    renderer.render(scene, camera);
  }

  animate();

  // Resize handler
  window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>

</body>
</html>
